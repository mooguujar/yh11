{
  "resolvedId": "/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue",
  "transforms": [
    {
      "name": "vite:load-fallback",
      "result": "<script setup lang=\"ts\">\nimport { computed, nextTick, onMounted, ref, watch, watchEffect } from 'vue'\nimport { useRoute } from 'vue-router'\nimport transfer01 from '@/assets/images/bricks/transfer01.png'\nimport transfer02 from '@/assets/images/bricks/transfer02.png'\nimport KGB01 from '@/assets/images/bricks/KGB01.png'\nimport USDT01 from '@/assets/images/bricks/USDT01.png'\nimport { useAuthStore } from '@/store'\nimport { storeToRefs } from 'pinia'\nimport { showToast } from 'vant'\nimport info from '@/assets/images/common/info.png'\nimport success from '@/assets/images/common/success.png'\nimport { getMoneyExchargeApi } from '@/apis/user'\n\nconst authStore = useAuthStore()\nconst { getUserCoin } = authStore\nconst { coins } = storeToRefs(authStore)\n\nconst route = useRoute()\n\n// 路由参数对应划转币种映射表\nconst routeParamsMap = {\n  'kgb-to-usdt': {\n    mtype: 30,\n    unit: 'CNY'\n  },\n  'usdt-to-kgb': {\n    mtype: 2,\n    unit: 'USDT'\n  }\n} as Record<string, any>\n\nconst [from, to] = (route.params.coin as string).split('-to-')\n\n// 币种划转映射表\nconst transferMap = ref({\n  from: routeParamsMap[from + '-to-' + to],\n  to: routeParamsMap[to + '-to-' + from]\n})\n// 划转条目信息\nconst transferCoinsInfo = ref([\n  { label: '可用金额', value: '0.00' },\n  { label: '手续费(0%)', value: '0.00' },\n  { label: '当前汇率', value: '0.00' },\n  { label: '划转获得', value: '0.00' },\n  { label: '最小划转数量', value: '0.00' }\n])\n// 划转数量\nconst transferCoinsAmount = ref('')\nconst inputAmount = ref()\n\n// 币种信息\nconst coinInfo = computed(() =>\n  coins.value?.find(item => item.mtype === transferMap.value.from.mtype)\n)\n// 转换目标币种信息\nconst toCoinInfo = computed(() =>\n  coins.value?.find(item => item.mtype === transferMap.value.to.mtype)\n)\n// 当前汇率\nconst currExchangeRate = computed(() => {\n  const fromCoinPrice = +(coinInfo.value?.coinset_config?.coin_price || 0)\n  const toCoinPrice = +(\n    coins.value?.find(item => item.mtype === transferMap.value.to.mtype)?.coinset_config\n      ?.coin_price || 1\n  )\n\n  return (fromCoinPrice / toCoinPrice).toTruncFixed(3)\n})\n// 最小划转数量\nconst minTransferAmount = computed(() => {\n  if (!coinInfo.value?.coinset_config) return '0.00'\n\n  return (\n    +coinInfo.value!.coinset_config!.min_swapto / +coinInfo.value!.coinset_config!.coin_price\n  ).toTruncFixed(2)\n})\n// 最大可划转数量(扣减手续费后)\nconst maxAvailableTransfer = computed(\n  () => +coinInfo.value!.available_coincash / (1 + +coinInfo.value!.coinset_config!.swapto_fee)\n)\n\n// 修正光标位置\nconst updateCursorPos = (onlyUpdateValue = false) => {\n  setTimeout(() => {\n    let amountInputEl = document.querySelector('.amount-input input') as HTMLInputElement\n\n    if (amountInputEl) {\n      amountInputEl.value = transferCoinsAmount.value\n\n      if (onlyUpdateValue) {\n        // 释放dom引用\n        amountInputEl = null as any\n        return\n      }\n\n      // 光标开始处\n      amountInputEl.selectionStart = transferCoinsAmount.value.length\n      // 光标结束处\n      amountInputEl.selectionEnd = transferCoinsAmount.value.length\n      // 释放dom引用\n      amountInputEl = null as any\n    }\n  }, 20)\n}\n\n// 输入内容修正\nwatch(transferCoinsAmount, (val, oldVal) => {\n  // 小数点开头，自动补齐0.\n  if (val === '.' || val.startsWith('00')) {\n    transferCoinsAmount.value = '0.'\n    updateCursorPos()\n    return\n  }\n\n  // 00开头变为0\n  if (oldVal && val.startsWith('0')) {\n    transferCoinsAmount.value = '0'\n  }\n\n  // 小数位数保留2位\n  const dotIndex = val.indexOf('.')\n  if (~dotIndex) {\n    const str = val.slice(dotIndex + 1, val.length)\n    const replacer = (match: string, p1: string, p2: string) => {\n      if (p1.startsWith('0') && +p1 > 0) {\n        return '0'\n      }\n      return p1 + '.' + p2\n    }\n    const newAmount = val.replace(/^(\\d+)\\.(\\d\\d).*$/, replacer)\n\n    transferCoinsAmount.value = newAmount\n    updateCursorPos(true)\n    return\n  }\n\n  // 提币输入超过最大提币数量时，变为最大可提币输入\n  if (+val > +maxAvailableTransfer.value) {\n    transferCoinsAmount.value = maxAvailableTransfer.value.toTruncFixed(2)\n    updateCursorPos()\n  }\n})\n\n// 更新划转相关条目配置数据\nwatchEffect(() => {\n  // 手续费费率\n  const swaptoFeeRate = +(coinInfo.value?.coinset_config?.swapto_fee || 0)\n  // 手续费\n  const swaptoFee = (+(transferCoinsAmount.value || 0) * swaptoFeeRate).toTruncFixed(2)\n  // 可用金额\n  const availableCoincash = (+coinInfo.value!.available_coincash).toTruncFixed(2)\n  // 划转获得\n  const finalCoincash = (+currExchangeRate.value * +(transferCoinsAmount.value || 0)).toTruncFixed(\n    2\n  )\n\n  transferCoinsInfo.value = [\n    { label: '可用金额', value: availableCoincash },\n    {\n      label: `手续费(${swaptoFeeRate * 100}%)`,\n      value: swaptoFee\n    },\n    {\n      label: '当前汇率',\n      value: currExchangeRate.value\n    },\n    {\n      label: '划转获得',\n      value: finalCoincash\n    },\n    {\n      label: '最小划转数量',\n      value: minTransferAmount.value\n    }\n  ]\n})\n\n// 切换币种划转\nconst onToggleTransfer = () => {\n  transferMap.value = {\n    from: transferMap.value.to,\n    to: transferMap.value.from\n  }\n  transferCoinsAmount.value = ''\n\n  // 更新汇率等信息\n  getUserCoin({})\n}\n\n// 最大划转数量\nconst onMaxAmount = () => {\n  transferCoinsAmount.value = maxAvailableTransfer.value.toTruncFixed(2)\n}\n// 确认划转\nconst onSubmit = async () => {\n  if (!transferCoinsAmount.value) {\n    showToast({\n      message: '请输入划转数量',\n      icon: info,\n      iconSize: '48px'\n    })\n    return\n  }\n\n  if (+transferCoinsAmount.value < +minTransferAmount.value) {\n    showToast({\n      message: '输入的数量小于最小划转数量',\n      icon: info,\n      iconSize: '48px'\n    })\n    return\n  }\n\n  try {\n    const res = await getMoneyExchargeApi({\n      num: transferCoinsAmount.value,\n      mtype: transferMap.value.from.mtype,\n      coin_name: coinInfo.value!.coin_name,\n      to_mtype: transferMap.value.to.mtype,\n      to_coin_name: toCoinInfo.value!.coin_name\n    })\n\n    if (res['code'] === 0) {\n      showToast({\n        message: '成功',\n        icon: success,\n        iconSize: '48px'\n      })\n      transferCoinsAmount.value = ''\n      getUserCoin({})\n    }\n\n    inputAmount.value?.focus()\n  } catch (error) {\n    console.error(error)\n  }\n}\n\n// 初始化提币输入框绑定事件\nconst initAmountEvent = () => {\n  nextTick(() => {\n    // 提币输入框禁止输入特定字符\n    const amountInputEl = document.querySelector('.amount-input input') as HTMLInputElement\n    if (amountInputEl) {\n      amountInputEl.onkeydown = e => {\n        if (['-', '+'].includes(e.key)) {\n          return e.preventDefault()\n        }\n      }\n    }\n  })\n}\n\nonMounted(() => {\n  getUserCoin({})\n  initAmountEvent()\n})\n</script>\n\n<template>\n  <div class=\"transfer-container flex flex-col justify-between\">\n    <div class=\"transfer-toggle-container flex justify-between\">\n      <div class=\"from-to flex flex-col justify-between\">\n        <div>从</div>\n        <img :src=\"transfer01\" />\n        <div>到</div>\n      </div>\n      <div\n        class=\"coin-icon-name flex justify-between\"\n        :class=\"transferMap.from.mtype === 30 ? 'flex-col' : 'flex-col-reverse'\"\n      >\n        <div class=\"row-item flex items-center\">\n          <img :src=\"KGB01\" />\n          <div>矿工币</div>\n        </div>\n        <div class=\"row-item flex items-center\">\n          <img :src=\"USDT01\" />\n          <div>USDT泰达币</div>\n        </div>\n      </div>\n      <div class=\"self-center\">\n        <img\n          :src=\"transfer02\"\n          class=\"icon-transfer\"\n          @click=\"onToggleTransfer\"\n        />\n      </div>\n    </div>\n\n    <div class=\"transfer-info-container\">\n      <div class=\"amount-text\">划转数量</div>\n\n      <div class=\"input-container flex justify-between items-center\">\n        <!-- 允许输入数字，调起带符号的纯数字键盘 -->\n        <van-field\n          v-model=\"transferCoinsAmount\"\n          ref=\"inputAmount\"\n          type=\"number\"\n          placeholder=\"请输入划转数量\"\n          class=\"amount-input\"\n        />\n        <div class=\"coin-unit\">{{ transferMap.from.unit }}</div>\n        <div\n          class=\"max-amount\"\n          @click=\"onMaxAmount\"\n        >\n          全部\n        </div>\n      </div>\n\n      <div class=\"item-info-container\">\n        <div\n          v-for=\"(item, index) in transferCoinsInfo\"\n          :key=\"index\"\n          class=\"row-item flex justify-between items-center\"\n        >\n          <div class=\"label\">{{ item.label }}</div>\n          <div class=\"value flex items-center\">\n            <span v-if=\"index === 2\">{{ `1 ${transferMap.from.unit} ≈ ${item.value}` }}</span>\n            <span\n              v-else\n              class=\"amount\"\n              :class=\"{ 'amount-bold': index === 0 }\"\n            >\n              {{ item.value }}\n            </span>\n            <span class=\"unit\">\n              {{ [0, 1, 4].includes(index) ? transferMap.from.unit : transferMap.to.unit }}\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div\n      class=\"btn-submit text-center\"\n      @click=\"onSubmit\"\n    >\n      确认划转\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n@import '@/assets/styles/sprite-home.scss';\n\n.transfer-container {\n  width: 100%;\n  height: 100%;\n  padding: 0 40px 97px 40px;\n  background-color: #fff;\n  .transfer-toggle-container {\n    width: 100%;\n    height: 208px;\n    padding: 0 33px 0 80px;\n    background-image: linear-gradient(#ebf1f6, #ebf1f6);\n    font-size: 25px;\n    border-radius: 14px;\n    .from-to {\n      padding: 30px 0;\n      color: #999;\n      img {\n        width: 22px;\n      }\n    }\n    .coin-icon-name {\n      margin: 0 auto 0 84px;\n      color: #000;\n      .row-item {\n        height: 84px;\n      }\n      img {\n        width: 57px;\n        height: 57px;\n        margin-right: 21px;\n      }\n    }\n    .icon-transfer {\n      width: 84px;\n      height: 84px;\n    }\n  }\n\n  .transfer-info-container {\n    margin: 40px 0 auto 0;\n    .amount-text {\n      font-size: 28px;\n      color: #333;\n    }\n\n    .input-container {\n      margin: 10px 0 21px;\n      padding: 0 20px;\n      background-image: linear-gradient(#ebf1f6, #ebf1f6);\n      font-size: 25px;\n      border-radius: 7px;\n      .amount-input {\n        flex: 1;\n        padding-left: 0;\n        background-color: #ebf1f6;\n      }\n      .coin-unit {\n        margin: 0 22px;\n        color: #868d9a;\n      }\n      .max-amount {\n        color: var(--van-button-primary-background);\n      }\n    }\n\n    .item-info-container {\n      padding: 0 21px;\n      background-color: #ebf1f6;\n      border-radius: 14px;\n    }\n\n    .row-item {\n      width: 100%;\n      height: 70px;\n      font-size: 25px;\n      background-color: #ebf1f6;\n      .label {\n        color: #787f8c;\n      }\n      .value {\n        color: #13161b;\n        .amount-bold {\n          font-size: 33px;\n          font-weight: bold;\n        }\n        .unit {\n          margin-left: 6px;\n        }\n      }\n    }\n  }\n\n  .btn-submit {\n    width: 100%;\n    height: 80px;\n    line-height: 80px;\n    font-size: 31px;\n    background-color: var(--van-button-primary-background);\n    color: #fff;\n    border-radius: 7px;\n  }\n}\n</style>\n",
      "start": 1714699769260,
      "end": 1714699769311,
      "sourcemaps": null
    },
    {
      "name": "vite:css",
      "start": 1714699769311,
      "end": 1714699769311,
      "order": "normal"
    },
    {
      "name": "vite:esbuild",
      "start": 1714699769311,
      "end": 1714699769311,
      "order": "normal"
    },
    {
      "name": "vite:json",
      "start": 1714699769311,
      "end": 1714699769311,
      "order": "normal"
    },
    {
      "name": "vite:worker",
      "start": 1714699769311,
      "end": 1714699769311,
      "order": "normal"
    },
    {
      "name": "vite:vue",
      "result": "import _sfc_main from \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=script&setup=true&lang.ts\";\nexport * from \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=script&setup=true&lang.ts\";\nimport \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=style&index=0&scoped=b1484c1a&lang.scss\";\nimport _export_sfc from \"\\0plugin-vue:export-helper\";\nexport default /* @__PURE__ */ _export_sfc(_sfc_main, [[\"__scopeId\", \"data-v-b1484c1a\"], [\"__file\", \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue\"]]);\n",
      "start": 1714699769311,
      "end": 1714699769537,
      "order": "normal",
      "sourcemaps": {
        "mappings": ""
      }
    },
    {
      "name": "vite:vue-jsx",
      "start": 1714699769537,
      "end": 1714699769537,
      "order": "normal"
    },
    {
      "name": "vite-plugin-vconsole",
      "result": "import _sfc_main from \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=script&setup=true&lang.ts\";\nexport * from \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=script&setup=true&lang.ts\";\nimport \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=style&index=0&scoped=b1484c1a&lang.scss\";\nimport _export_sfc from \"\\0plugin-vue:export-helper\";\nexport default /* @__PURE__ */ _export_sfc(_sfc_main, [[\"__scopeId\", \"data-v-b1484c1a\"], [\"__file\", \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue\"]]);\n",
      "start": 1714699769537,
      "end": 1714699769537,
      "order": "normal",
      "sourcemaps": null
    },
    {
      "name": "esbuild",
      "result": "\"use strict\";\nimport _sfc_main from \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=script&setup=true&lang.ts\";\nexport * from \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=script&setup=true&lang.ts\";\nimport \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=style&index=0&scoped=b1484c1a&lang.scss\";\nimport _export_sfc from \"\\0plugin-vue:export-helper\";\nexport default /* @__PURE__ */ _export_sfc(_sfc_main, [[\"__scopeId\", \"data-v-b1484c1a\"], [\"__file\", \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue\"]]);\n",
      "start": 1714699769537,
      "end": 1714699769943,
      "order": "normal",
      "sourcemaps": "{\n  \"version\": 3,\n  \"sources\": [\"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue\"],\n  \"sourcesContent\": [\"import _sfc_main from \\\"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=script&setup=true&lang.ts\\\";\\nexport * from \\\"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=script&setup=true&lang.ts\\\";\\nimport \\\"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=style&index=0&scoped=b1484c1a&lang.scss\\\";\\nimport _export_sfc from \\\"\\\\0plugin-vue:export-helper\\\";\\nexport default /* @__PURE__ */ _export_sfc(_sfc_main, [[\\\"__scopeId\\\", \\\"data-v-b1484c1a\\\"], [\\\"__file\\\", \\\"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue\\\"]]);\\n\"],\n  \"mappings\": \";AAAA,OAAO,eAAe;AACtB,cAAc;AACd,OAAO;AACP,OAAO,iBAAiB;AACxB,eAA+B,4BAAY,WAAW,CAAC,CAAC,aAAa,iBAAiB,GAAG,CAAC,UAAU,qEAAqE,CAAC,CAAC;\",\n  \"names\": []\n}\n"
    },
    {
      "name": "vite:define",
      "start": 1714699769943,
      "end": 1714699769943,
      "order": "normal"
    },
    {
      "name": "vite:css-post",
      "start": 1714699769943,
      "end": 1714699769943,
      "order": "normal"
    },
    {
      "name": "vite:build-html",
      "start": 1714699769943,
      "end": 1714699769943,
      "order": "normal"
    },
    {
      "name": "vite:worker-import-meta-url",
      "start": 1714699769943,
      "end": 1714699769943,
      "order": "normal"
    },
    {
      "name": "vite:asset-import-meta-url",
      "start": 1714699769943,
      "end": 1714699769943,
      "order": "normal"
    },
    {
      "name": "commonjs",
      "start": 1714699769943,
      "end": 1714699769943,
      "order": "normal"
    },
    {
      "name": "vite:dynamic-import-vars",
      "start": 1714699769943,
      "end": 1714699769943,
      "order": "normal"
    },
    {
      "name": "vite:import-glob",
      "start": 1714699769943,
      "end": 1714699769943,
      "order": "normal"
    },
    {
      "name": "unplugin-auto-import",
      "start": 1714699769943,
      "end": 1714699769943,
      "order": "post"
    },
    {
      "name": "unplugin-vue-components",
      "result": "/* unplugin-vue-components disabled */\"use strict\";\nimport _sfc_main from \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=script&setup=true&lang.ts\";\nexport * from \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=script&setup=true&lang.ts\";\nimport \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=style&index=0&scoped=b1484c1a&lang.scss\";\nimport _export_sfc from \"\\0plugin-vue:export-helper\";\nexport default /* @__PURE__ */ _export_sfc(_sfc_main, [[\"__scopeId\", \"data-v-b1484c1a\"], [\"__file\", \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue\"]]);\n",
      "start": 1714699769943,
      "end": 1714699769943,
      "order": "post",
      "sourcemaps": {
        "version": 3,
        "sources": [
          "/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue"
        ],
        "sourcesContent": [
          "\"use strict\";\nimport _sfc_main from \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=script&setup=true&lang.ts\";\nexport * from \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=script&setup=true&lang.ts\";\nimport \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue?vue&type=style&index=0&scoped=b1484c1a&lang.scss\";\nimport _export_sfc from \"\\0plugin-vue:export-helper\";\nexport default /* @__PURE__ */ _export_sfc(_sfc_main, [[\"__scopeId\", \"data-v-b1484c1a\"], [\"__file\", \"/Users/afeng/Desktop/work/gdpayh5-web/src/pages/Bricks/Transfer.vue\"]]);\n"
        ],
        "names": [],
        "mappings": "sCAAA;AACA;AACA;AACA;AACA;AACA;"
      }
    },
    {
      "name": "vite:style-import",
      "start": 1714699769943,
      "end": 1714699769943,
      "order": "post"
    },
    {
      "name": "vite:build-import-analysis",
      "start": 1714699769943,
      "end": 1714699769943,
      "order": "normal"
    },
    {
      "name": "vite:reporter",
      "start": 1714699769943,
      "end": 1714699769943,
      "order": "normal"
    }
  ]
}
